<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <title>Jfresolve Configuration</title>
    </head>

    <body>
        <div
            id="JfresolveConfigPage"
            data-role="page"
            class="page type-interior pluginConfigurationPage"
            data-require="emby-input,emby-button,emby-checkbox,emby-select,emby-textarea"
        >
            <style>
                .jfresolve-config-page {
                    padding: 20px;
                    color: #eee;
                }

                .section-card {
                    background: #1e1e1e;
                    border-radius: 12px;
                    padding: 24px;
                    margin-bottom: 30px;
                    border: 1px solid #333;
                    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
                }

                .section-title {
                    color: #00a4dc;
                    margin-top: 0;
                    margin-bottom: 20px;
                    font-weight: 500;
                    display: flex;
                    align-items: center;
                    gap: 10px;
                }

                .section-title i {
                    color: #00a4dc;
                }

                .field-group {
                    margin-bottom: 25px;
                }

                .field-description {
                    color: #aaa;
                    font-size: 0.9em;
                    margin-top: 8px;
                    line-height: 1.5;
                }

                .alert-info {
                    background: rgba(0, 164, 220, 0.1);
                    border-left: 4px solid #00a4dc;
                    padding: 15px;
                    border-radius: 4px;
                    margin-bottom: 20px;
                    color: #ddd;
                }

                .alert-warning {
                    background: rgba(255, 170, 0, 0.1);
                    border-left: 4px solid #ffaa00;
                    padding: 15px;
                    border-radius: 4px;
                    margin-bottom: 20px;
                    color: #ddd;
                }

                .quality-grid {
                    display: grid;
                    grid-template-columns: repeat(
                        auto-fill,
                        minmax(200px, 1fr)
                    );
                    gap: 15px;
                    margin-top: 15px;
                    background: #252525;
                    padding: 20px;
                    border-radius: 8px;
                }

                .emby-input,
                .emby-select,
                .emby-textarea {
                    width: 100% !important;
                }

                .checkbox-label-text {
                    font-weight: 500;
                    color: #eee;
                }

                .button-submit {
                    background: #00a4dc !important;
                    border-radius: 8px !important;
                    padding: 12px 24px !important;
                    font-weight: 600 !important;
                }

                .mode-section {
                    padding: 20px;
                    background: #252525;
                    border-radius: 8px;
                    margin-top: 15px;
                    border: 1px dashed #444;
                }

                code {
                    background: #333;
                    padding: 2px 4px;
                    border-radius: 4px;
                    font-family: monospace;
                }
            </style>

            <div data-role="content">
                <div class="content-primary">
                    <form
                        id="JfresolveConfigForm"
                        class="jfresolve-config-page"
                    >
                        <div class="verticalSection">
                            <div
                                class="sectionTitleContainer flex align-items-center"
                                style="margin-bottom: 30px"
                            >
                                <h2
                                    class="sectionTitle"
                                    style="font-size: 2em; color: #fff"
                                >
                                    Jfresolve
                                    <span>Settings</span>
                                </h2>
                            </div>

                            <!-- General Settings -->
                            <div class="section-card">
                                <h3 class="section-title">General Settings</h3>

                                <div class="alert-warning">
                                    <strong>⚠️ First Run Setup:</strong> After
                                    configuring library paths, restart Jellyfin
                                    and perform a "Scan All Libraries" to
                                    initialize the database.
                                </div>

                                <div class="inputContainer field-group">
                                    <label
                                        class="inputLabel"
                                        for="JellyfinServerUrl"
                                        >Jellyfin Server URL</label
                                    >
                                    <input
                                        type="text"
                                        id="JellyfinServerUrl"
                                        is="emby-input"
                                        class="emby-input"
                                        placeholder="http://localhost:8096"
                                    />
                                    <div class="field-description">
                                        Your Jellyfin server URL (e.g.,
                                        http://localhost:8096). Used for stream
                                        resolution URL construction.
                                    </div>
                                </div>

                                <div class="inputContainer field-group">
                                    <label
                                        class="inputLabel"
                                        for="AddonManifestUrl"
                                        >Stremio Addon Manifest URL</label
                                    >
                                    <input
                                        type="text"
                                        id="AddonManifestUrl"
                                        is="emby-input"
                                        class="emby-input"
                                        placeholder="stremio://your-addon/manifest.json"
                                    />
                                    <div class="field-description">
                                        Stremio addon manifest URL for resolving
                                        streams.
                                    </div>
                                </div>

                                <div class="checkboxContainer field-group">
                                    <label
                                        class="emby-checkbox-label"
                                        for="EnableSearch"
                                    >
                                        <input
                                            type="checkbox"
                                            is="emby-checkbox"
                                            id="EnableSearch"
                                        />
                                        <span class="checkbox-label-text"
                                            >Enable Search Interception</span
                                        >
                                    </label>
                                    <div class="field-description">
                                        When enabled, global search will return
                                        virtual items from TMDB.
                                    </div>
                                </div>
                            </div>

                            <!-- Path Configuration -->
                            <div class="section-card">
                                <h3 class="section-title">
                                    Library Folder Paths
                                </h3>

                                <div class="selectContainer field-group">
                                    <label class="selectLabel" for="PathMode"
                                        >Path Configuration Mode</label
                                    >
                                    <select
                                        is="emby-select"
                                        id="PathMode"
                                        class="emby-select-withcolor emby-select"
                                    >
                                        <option value="0">
                                            Simple Mode (Unified Paths)
                                        </option>
                                        <option value="1">
                                            Advanced Mode (Split
                                            Search/Auto-Populate)
                                        </option>
                                    </select>
                                    <div class="field-description">
                                        Choose how library folders are assigned
                                        for different insertion methods.
                                    </div>
                                </div>

                                <!-- Simple Mode Section -->
                                <div
                                    id="simpleModeSection"
                                    class="mode-section"
                                    style="display: none"
                                >
                                    <div
                                        class="sectionTitle"
                                        style="margin-bottom: 20px"
                                    >
                                        <h4 style="color: #00a4dc; margin: 0">
                                            Simple Mode - Unified Paths
                                        </h4>
                                    </div>
                                    <div class="inputContainer field-group">
                                        <label
                                            class="inputLabel"
                                            for="MoviePath"
                                            >Movie Library Path</label
                                        >
                                        <input
                                            type="text"
                                            id="MoviePath"
                                            is="emby-input"
                                            class="emby-input"
                                        />
                                    </div>
                                    <div class="inputContainer field-group">
                                        <label
                                            class="inputLabel"
                                            for="SeriesPath"
                                            >TV Series Library Path</label
                                        >
                                        <input
                                            type="text"
                                            id="SeriesPath"
                                            is="emby-input"
                                            class="emby-input"
                                        />
                                    </div>
                                    <div class="checkboxContainer field-group">
                                        <label
                                            class="emby-checkbox-label"
                                            for="EnableAnimeFolder"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="EnableAnimeFolder"
                                            />
                                            <span>Separate Anime Folder</span>
                                        </label>
                                    </div>
                                    <div
                                        id="animePathContainer"
                                        class="inputContainer field-group"
                                    >
                                        <label
                                            class="inputLabel"
                                            for="AnimePath"
                                            >Anime Library Path</label
                                        >
                                        <input
                                            type="text"
                                            id="AnimePath"
                                            is="emby-input"
                                            class="emby-input"
                                        />
                                    </div>
                                </div>

                                <!-- Advanced Mode Section -->
                                <div
                                    id="advancedModeSection"
                                    class="mode-section"
                                    style="display: none"
                                >
                                    <div
                                        class="sectionTitle"
                                        style="margin-bottom: 20px"
                                    >
                                        <h4 style="color: #00a4dc; margin: 0">
                                            Advanced Mode - Specific Paths
                                        </h4>
                                    </div>

                                    <div
                                        style="
                                            display: grid;
                                            grid-template-columns: 1fr 1fr;
                                            gap: 20px;
                                        "
                                    >
                                        <div>
                                            <div
                                                class="sectionTitle"
                                                style="margin-bottom: 10px"
                                            >
                                                <h5 style="margin: 0">
                                                    Search Results
                                                </h5>
                                            </div>
                                            <div
                                                class="inputContainer field-group"
                                            >
                                                <label
                                                    class="inputLabel"
                                                    for="MovieSearchPath"
                                                    >Movie Search Path</label
                                                >
                                                <input
                                                    type="text"
                                                    id="MovieSearchPath"
                                                    is="emby-input"
                                                    placeholder="Movie Search Path"
                                                />
                                            </div>
                                            <div
                                                class="inputContainer field-group"
                                            >
                                                <label
                                                    class="inputLabel"
                                                    for="SeriesSearchPath"
                                                    >TV Series Search
                                                    Path</label
                                                >
                                                <input
                                                    type="text"
                                                    id="SeriesSearchPath"
                                                    is="emby-input"
                                                    placeholder="TV Series Search Path"
                                                />
                                            </div>
                                            <div
                                                class="inputContainer field-group"
                                            >
                                                <label
                                                    class="inputLabel"
                                                    for="AnimeSearchPath"
                                                    >Anime Search Path</label
                                                >
                                                <input
                                                    type="text"
                                                    id="AnimeSearchPath"
                                                    is="emby-input"
                                                    placeholder="Anime Search Path"
                                                />
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                class="sectionTitle"
                                                style="margin-bottom: 10px"
                                            >
                                                <h5 style="margin: 0">
                                                    Auto-Populate
                                                </h5>
                                            </div>
                                            <div
                                                class="inputContainer field-group"
                                            >
                                                <label
                                                    class="inputLabel"
                                                    for="MovieAutoPopulatePath"
                                                    >Movie Auto Path</label
                                                >
                                                <input
                                                    type="text"
                                                    id="MovieAutoPopulatePath"
                                                    is="emby-input"
                                                    placeholder="Movie Auto Path"
                                                />
                                            </div>
                                            <div
                                                class="inputContainer field-group"
                                            >
                                                <label
                                                    class="inputLabel"
                                                    for="SeriesAutoPopulatePath"
                                                    >TV Series Auto Path</label
                                                >
                                                <input
                                                    type="text"
                                                    id="SeriesAutoPopulatePath"
                                                    is="emby-input"
                                                    placeholder="TV Series Auto Path"
                                                />
                                            </div>
                                            <div
                                                class="inputContainer field-group"
                                            >
                                                <label
                                                    class="inputLabel"
                                                    for="AnimeAutoPopulatePath"
                                                    >Anime Auto Path</label
                                                >
                                                <input
                                                    type="text"
                                                    id="AnimeAutoPopulatePath"
                                                    is="emby-input"
                                                    placeholder="Anime Auto Path"
                                                />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="checkboxContainer field-group">
                                        <label
                                            class="emby-checkbox-label"
                                            for="EnableAnimeFolderAdvanced"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="EnableAnimeFolderAdvanced"
                                            />
                                            <span
                                                >Enable Dedicated Anime
                                                Paths</span
                                            >
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <!-- Virtual Versioning -->
                            <div class="section-card">
                                <h3 class="section-title">
                                    Virtual Versioning
                                </h3>
                                <div class="alert-info">
                                    Enable multiple quality versions for each
                                    virtual item. Jellyfin will group these
                                    options under a "Version" dropdown.
                                </div>

                                <div class="quality-grid">
                                    <div class="checkboxContainer">
                                        <label
                                            class="emby-checkbox-label"
                                            for="Enable4KVersion"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="Enable4KVersion"
                                            />
                                            <span class="checkbox-label-text"
                                                >4K / 2160p</span
                                            >
                                        </label>
                                    </div>
                                    <div class="checkboxContainer">
                                        <label
                                            class="emby-checkbox-label"
                                            for="Enable1080pVersion"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="Enable1080pVersion"
                                            />
                                            <span class="checkbox-label-text"
                                                >1080p HD</span
                                            >
                                        </label>
                                    </div>
                                    <div class="checkboxContainer">
                                        <label
                                            class="emby-checkbox-label"
                                            for="Enable720pVersion"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="Enable720pVersion"
                                            />
                                            <span class="checkbox-label-text"
                                                >720p HD</span
                                            >
                                        </label>
                                    </div>
                                    <div class="checkboxContainer">
                                        <label
                                            class="emby-checkbox-label"
                                            for="EnableUnknownVersion"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="EnableUnknownVersion"
                                            />
                                            <span class="checkbox-label-text"
                                                >Unknown / Any</span
                                            >
                                        </label>
                                    </div>
                                </div>

                                <div
                                    class="inputContainer field-group"
                                    style="margin-top: 25px"
                                >
                                    <label
                                        class="inputLabel"
                                        for="MaxItemsPerQuality"
                                        >Max Streams per Quality</label
                                    >
                                    <input
                                        type="number"
                                        id="MaxItemsPerQuality"
                                        is="emby-input"
                                        min="1"
                                        max="10"
                                        value="1"
                                    />
                                    <div class="field-description">
                                        Add multiple entries for the same
                                        quality if available (up to 10 indices
                                        per quality).
                                    </div>
                                </div>

                                <div class="selectContainer field-group">
                                    <label
                                        class="selectLabel"
                                        for="PreferredQuality"
                                        >Fallback Quality (Discovery)</label
                                    >
                                    <select
                                        is="emby-select"
                                        id="PreferredQuality"
                                        class="emby-select-withcolor emby-select"
                                    >
                                        <option value="Auto">
                                            Auto (Highest Available)
                                        </option>
                                        <option value="4K">4K / 2160p</option>
                                        <option value="1440p">1440p</option>
                                        <option value="1080p">1080p</option>
                                        <option value="720p">720p</option>
                                        <option value="480p">480p</option>
                                    </select>
                                    <div class="field-description">
                                        This quality is used when virtual
                                        versioning is disabled or as a fallback
                                        if a specifically requested
                                        version/index is unavailable.
                                    </div>
                                </div>
                            </div>

                            <!-- TMDB & Population -->
                            <div
                                class="section-card"
                                style="
                                    display: grid;
                                    grid-template-columns: 1fr 1fr;
                                    gap: 30px;
                                "
                            >
                                <div>
                                    <h3 class="section-title">TMDB API</h3>
                                    <div class="inputContainer field-group">
                                        <label
                                            class="inputLabel"
                                            for="TmdbApiKey"
                                            >API Key</label
                                        >
                                        <input
                                            type="text"
                                            id="TmdbApiKey"
                                            is="emby-input"
                                        />
                                    </div>
                                    <div class="inputContainer field-group">
                                        <label
                                            class="inputLabel"
                                            for="SearchResultLimit"
                                            >Search Limit</label
                                        >
                                        <input
                                            type="number"
                                            id="SearchResultLimit"
                                            is="emby-input"
                                            min="1"
                                            max="100"
                                        />
                                    </div>
                                    <div class="checkboxContainer">
                                        <label
                                            class="emby-checkbox-label"
                                            for="IncludeAdult"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="IncludeAdult"
                                            />
                                            <span>Include Adult Content</span>
                                        </label>
                                    </div>
                                </div>
                                <div>
                                    <h3 class="section-title">
                                        Auto-Population
                                    </h3>
                                    <div class="checkboxContainer field-group">
                                        <label
                                            class="emby-checkbox-label"
                                            for="EnableAutoPopulation"
                                        >
                                            <input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="EnableAutoPopulation"
                                            />
                                            <span>Enable Auto-Population</span>
                                        </label>
                                    </div>
                                    <div class="field-group">
                                        <label
                                            class="emby-checkbox-label"
                                            for="UseTrendingSource"
                                            ><input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="UseTrendingSource"
                                            />
                                            <span>Trending</span></label
                                        >
                                        <label
                                            class="emby-checkbox-label"
                                            for="UsePopularSource"
                                            ><input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="UsePopularSource"
                                            />
                                            <span>Popular</span></label
                                        >
                                        <label
                                            class="emby-checkbox-label"
                                            for="UseTopRatedSource"
                                            ><input
                                                type="checkbox"
                                                is="emby-checkbox"
                                                id="UseTopRatedSource"
                                            />
                                            <span>Top Rated</span></label
                                        >
                                    </div>
                                    <div class="inputContainer">
                                        <label
                                            class="inputLabel"
                                            for="PopulationResultLimit"
                                            >Items per Run</label
                                        >
                                        <input
                                            type="number"
                                            id="PopulationResultLimit"
                                            is="emby-input"
                                            min="1"
                                            max="100"
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- Maintenance -->
                            <div class="section-card">
                                <h3 class="section-title">
                                    Exclusion & Maintenance
                                </h3>
                                <div
                                    class="inputContainer field-group"
                                    style="width: 100%"
                                >
                                    <label
                                        class="inputLabel"
                                        for="ExclusionList"
                                        >Excluded TMDB IDs</label
                                    >
                                    <textarea
                                        id="ExclusionList"
                                        is="emby-textarea"
                                        class="emby-textarea"
                                        rows="2"
                                        placeholder="12345, 67890"
                                        style="
                                            width: 100%;
                                            box-sizing: border-box;
                                        "
                                    ></textarea>
                                    <div class="field-description">
                                        Comma-separated IDs to ignore during
                                        auto-population.
                                    </div>
                                </div>

                                <div
                                    style="
                                        display: flex;
                                        justify-content: space-between;
                                        align-items: center;
                                        margin-top: 20px;
                                        padding: 15px;
                                        background: #252525;
                                        border-radius: 6px;
                                    "
                                >
                                    <div
                                        id="lastPopulationRunDisplay"
                                        style="font-style: italic; color: #888"
                                    >
                                        Last Run: Never
                                    </div>
                                    <div style="color: #666; font-size: 0.85em">
                                        Build: 10.11.x
                                    </div>
                                </div>
                            </div>

                            <!-- FFmpeg -->
                            <div class="section-card">
                                <h3 class="section-title">FFmpeg Tweaks</h3>
                                <div class="checkboxContainer field-group">
                                    <label
                                        class="emby-checkbox-label"
                                        for="EnableCustomFFmpegSettings"
                                    >
                                        <input
                                            type="checkbox"
                                            is="emby-checkbox"
                                            id="EnableCustomFFmpegSettings"
                                        />
                                        <span
                                            >Override Default FFmpeg
                                            Settings</span
                                        >
                                    </label>
                                </div>
                                <div
                                    style="
                                        display: grid;
                                        grid-template-columns: 1fr 1fr;
                                        gap: 20px;
                                    "
                                >
                                    <div class="inputContainer">
                                        <label
                                            class="inputLabel"
                                            for="FFmpegAnalyzeDuration"
                                            >analyze-duration</label
                                        >
                                        <input
                                            type="text"
                                            id="FFmpegAnalyzeDuration"
                                            is="emby-input"
                                            placeholder="5M"
                                        />
                                    </div>
                                    <div class="inputContainer">
                                        <label
                                            class="inputLabel"
                                            for="FFmpegProbeSize"
                                            >probe-size</label
                                        >
                                        <input
                                            type="text"
                                            id="FFmpegProbeSize"
                                            is="emby-input"
                                            placeholder="40M"
                                        />
                                    </div>
                                </div>
                            </div>

                            <!-- Failover Settings -->
                            <div class="section-card">
                                <h3 class="section-title">
                                    EXPERIMENTAL!: Automatic Failover
                                </h3>
                                <div class="alert-info">
                                    When enabled, the plugin will automatically
                                    try different quality versions or indices if
                                    a stream fails to play. Uses time windows to
                                    avoid switching links too quickly during
                                    buffering.
                                </div>

                                <div class="checkboxContainer field-group">
                                    <label
                                        class="emby-checkbox-label"
                                        for="EnableMovieFailover"
                                    >
                                        <input
                                            type="checkbox"
                                            is="emby-checkbox"
                                            id="EnableMovieFailover"
                                        />
                                        <span>Enable Failover for Movies</span>
                                    </label>
                                    <div class="field-description">
                                        Automatically try next available stream
                                        if movie playback fails
                                    </div>
                                </div>

                                <div class="checkboxContainer field-group">
                                    <label
                                        class="emby-checkbox-label"
                                        for="EnableShowFailover"
                                    >
                                        <input
                                            type="checkbox"
                                            is="emby-checkbox"
                                            id="EnableShowFailover"
                                        />
                                        <span
                                            >Enable Failover for TV Shows</span
                                        >
                                    </label>
                                    <div class="field-description">
                                        Automatically try next available stream
                                        if episode playback fails
                                    </div>
                                </div>

                                <div
                                    style="
                                        display: grid;
                                        grid-template-columns: 1fr 1fr;
                                        gap: 20px;
                                        margin-top: 20px;
                                    "
                                >
                                    <div class="inputContainer">
                                        <label
                                            class="inputLabel"
                                            for="FailoverGracePeriodSeconds"
                                        >
                                            Grace Period (seconds)
                                        </label>
                                        <input
                                            type="number"
                                            id="FailoverGracePeriodSeconds"
                                            is="emby-input"
                                            min="10"
                                            max="300"
                                            value="45"
                                        />
                                        <div class="field-description">
                                            Wait this long before trying next
                                            stream (allows buffering). Default:
                                            45s
                                        </div>
                                    </div>

                                    <div class="inputContainer">
                                        <label
                                            class="inputLabel"
                                            for="FailoverWindowSeconds"
                                        >
                                            Reset Window (seconds)
                                        </label>
                                        <input
                                            type="number"
                                            id="FailoverWindowSeconds"
                                            is="emby-input"
                                            min="60"
                                            max="600"
                                            value="120"
                                        />
                                        <div class="field-description">
                                            After this time, assume success and
                                            reset to first stream. Default: 120s
                                            (2 min)
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="margin-top: 40px">
                                <button
                                    is="emby-button"
                                    type="submit"
                                    class="raised button-submit block emby-button"
                                >
                                    <span>Save Configuration</span>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <script type="text/javascript">
                var JfresolveConfig = {
                    pluginUniqueId: "506F18B8-5DAD-4CD3-B9A0-F7ED933E9939",
                };

                function toggleSections() {
                    var pathMode =
                        parseInt(document.getElementById("PathMode").value) ||
                        0;
                    document.getElementById("simpleModeSection").style.display =
                        pathMode === 0 ? "block" : "none";
                    document.getElementById(
                        "advancedModeSection",
                    ).style.display = pathMode === 1 ? "block" : "none";
                }

                document
                    .getElementById("JfresolveConfigPage")
                    .addEventListener("pageshow", function () {
                        document
                            .getElementById("PathMode")
                            .addEventListener("change", toggleSections);

                        Dashboard.showLoadingMsg();
                        ApiClient.getPluginConfiguration(
                            JfresolveConfig.pluginUniqueId,
                        ).then(function (config) {
                            // General
                            document.getElementById("JellyfinServerUrl").value =
                                config.JellyfinServerUrl ||
                                "http://localhost:8096";
                            document.getElementById("AddonManifestUrl").value =
                                config.AddonManifestUrl || "";
                            document.getElementById("EnableSearch").checked =
                                config.EnableSearch !== false;
                            document.getElementById("PreferredQuality").value =
                                config.PreferredQuality || "Auto";

                            // Path Mode
                            var pathMode =
                                config.PathMode === "Advanced"
                                    ? 1
                                    : config.PathMode === "Simple"
                                      ? 0
                                      : (config.PathMode ?? 0);
                            document.getElementById("PathMode").value =
                                pathMode.toString();

                            // Simple Paths
                            document.getElementById("MoviePath").value =
                                config.MoviePath || "";
                            document.getElementById("SeriesPath").value =
                                config.SeriesPath || "";
                            document.getElementById(
                                "EnableAnimeFolder",
                            ).checked = config.EnableAnimeFolder || false;
                            document.getElementById("AnimePath").value =
                                config.AnimePath || "";

                            // Advanced Paths
                            document.getElementById("MovieSearchPath").value =
                                config.MovieSearchPath || "";
                            document.getElementById("SeriesSearchPath").value =
                                config.SeriesSearchPath || "";
                            document.getElementById("AnimeSearchPath").value =
                                config.AnimeSearchPath || "";
                            document.getElementById(
                                "MovieAutoPopulatePath",
                            ).value = config.MovieAutoPopulatePath || "";
                            document.getElementById(
                                "SeriesAutoPopulatePath",
                            ).value = config.SeriesAutoPopulatePath || "";
                            document.getElementById(
                                "AnimeAutoPopulatePath",
                            ).value = config.AnimeAutoPopulatePath || "";
                            document.getElementById(
                                "EnableAnimeFolderAdvanced",
                            ).checked =
                                config.EnableAnimeFolderAdvanced || false;

                            // Virtual Versioning
                            document.getElementById("Enable4KVersion").checked =
                                config.Enable4KVersion || false;
                            document.getElementById(
                                "Enable1080pVersion",
                            ).checked = config.Enable1080pVersion || false;
                            document.getElementById(
                                "Enable720pVersion",
                            ).checked = config.Enable720pVersion || false;
                            document.getElementById(
                                "EnableUnknownVersion",
                            ).checked = config.EnableUnknownVersion || false;
                            document.getElementById(
                                "MaxItemsPerQuality",
                            ).value = config.MaxItemsPerQuality || 1;

                            // TMDB & Population
                            document.getElementById("TmdbApiKey").value =
                                config.TmdbApiKey || "";
                            document.getElementById("SearchResultLimit").value =
                                config.SearchResultLimit || 15;
                            document.getElementById("IncludeAdult").checked =
                                config.IncludeAdult || false;
                            document.getElementById(
                                "EnableAutoPopulation",
                            ).checked = config.EnableAutoPopulation || false;
                            document.getElementById(
                                "UseTrendingSource",
                            ).checked = config.UseTrendingSource !== false;
                            document.getElementById(
                                "UsePopularSource",
                            ).checked = config.UsePopularSource || false;
                            document.getElementById(
                                "UseTopRatedSource",
                            ).checked = config.UseTopRatedSource || false;
                            document.getElementById(
                                "PopulationResultLimit",
                            ).value = config.PopulationResultLimit || 20;
                            document.getElementById("ExclusionList").value =
                                config.ExclusionList || "";

                            // Maintenance
                            if (config.LastPopulationRun) {
                                document.getElementById(
                                    "lastPopulationRunDisplay",
                                ).textContent =
                                    "Last Run: " +
                                    new Date(
                                        config.LastPopulationRun,
                                    ).toLocaleString();
                            }

                            // FFmpeg
                            document.getElementById(
                                "EnableCustomFFmpegSettings",
                            ).checked =
                                config.EnableCustomFFmpegSettings || false;
                            document.getElementById(
                                "FFmpegAnalyzeDuration",
                            ).value = config.FFmpegAnalyzeDuration || "5M";
                            document.getElementById("FFmpegProbeSize").value =
                                config.FFmpegProbeSize || "40M";

                            // Failover
                            document.getElementById(
                                "EnableMovieFailover",
                            ).checked = config.EnableMovieFailover || false;
                            document.getElementById(
                                "EnableShowFailover",
                            ).checked = config.EnableShowFailover || false;
                            document.getElementById(
                                "FailoverGracePeriodSeconds",
                            ).value = config.FailoverGracePeriodSeconds || 45;
                            document.getElementById(
                                "FailoverWindowSeconds",
                            ).value = config.FailoverWindowSeconds || 120;

                            toggleSections();
                            Dashboard.hideLoadingMsg();
                        });
                    });

                document
                    .getElementById("JfresolveConfigForm")
                    .addEventListener("submit", function (e) {
                        e.preventDefault();
                        Dashboard.showLoadingMsg();

                        ApiClient.getPluginConfiguration(
                            JfresolveConfig.pluginUniqueId,
                        ).then(function (config) {
                            config.JellyfinServerUrl =
                                document.getElementById(
                                    "JellyfinServerUrl",
                                ).value;
                            config.AddonManifestUrl =
                                document.getElementById(
                                    "AddonManifestUrl",
                                ).value;
                            config.EnableSearch =
                                document.getElementById("EnableSearch").checked;
                            config.PreferredQuality =
                                document.getElementById(
                                    "PreferredQuality",
                                ).value;
                            config.PathMode = parseInt(
                                document.getElementById("PathMode").value,
                            );

                            config.MoviePath =
                                document.getElementById("MoviePath").value;
                            config.SeriesPath =
                                document.getElementById("SeriesPath").value;
                            config.EnableAnimeFolder =
                                document.getElementById(
                                    "EnableAnimeFolder",
                                ).checked;
                            config.AnimePath =
                                document.getElementById("AnimePath").value;

                            config.MovieSearchPath =
                                document.getElementById(
                                    "MovieSearchPath",
                                ).value;
                            config.SeriesSearchPath =
                                document.getElementById(
                                    "SeriesSearchPath",
                                ).value;
                            config.AnimeSearchPath =
                                document.getElementById(
                                    "AnimeSearchPath",
                                ).value;
                            config.MovieAutoPopulatePath =
                                document.getElementById(
                                    "MovieAutoPopulatePath",
                                ).value;
                            config.SeriesAutoPopulatePath =
                                document.getElementById(
                                    "SeriesAutoPopulatePath",
                                ).value;
                            config.AnimeAutoPopulatePath =
                                document.getElementById(
                                    "AnimeAutoPopulatePath",
                                ).value;
                            config.EnableAnimeFolderAdvanced =
                                document.getElementById(
                                    "EnableAnimeFolderAdvanced",
                                ).checked;

                            // Versioning
                            config.Enable4KVersion =
                                document.getElementById(
                                    "Enable4KVersion",
                                ).checked;
                            config.Enable1080pVersion =
                                document.getElementById(
                                    "Enable1080pVersion",
                                ).checked;
                            config.Enable720pVersion =
                                document.getElementById(
                                    "Enable720pVersion",
                                ).checked;
                            config.EnableUnknownVersion =
                                document.getElementById(
                                    "EnableUnknownVersion",
                                ).checked;
                            config.MaxItemsPerQuality = parseInt(
                                document.getElementById("MaxItemsPerQuality")
                                    .value,
                            );

                            config.TmdbApiKey =
                                document.getElementById("TmdbApiKey").value;
                            config.SearchResultLimit = parseInt(
                                document.getElementById("SearchResultLimit")
                                    .value,
                            );
                            config.IncludeAdult =
                                document.getElementById("IncludeAdult").checked;
                            config.EnableAutoPopulation =
                                document.getElementById(
                                    "EnableAutoPopulation",
                                ).checked;
                            config.UseTrendingSource =
                                document.getElementById(
                                    "UseTrendingSource",
                                ).checked;
                            config.UsePopularSource =
                                document.getElementById(
                                    "UsePopularSource",
                                ).checked;
                            config.UseTopRatedSource =
                                document.getElementById(
                                    "UseTopRatedSource",
                                ).checked;
                            config.PopulationResultLimit = parseInt(
                                document.getElementById("PopulationResultLimit")
                                    .value,
                            );
                            config.ExclusionList =
                                document.getElementById("ExclusionList").value;

                            config.EnableCustomFFmpegSettings =
                                document.getElementById(
                                    "EnableCustomFFmpegSettings",
                                ).checked;
                            config.FFmpegAnalyzeDuration =
                                document.getElementById(
                                    "FFmpegAnalyzeDuration",
                                ).value;
                            config.FFmpegProbeSize =
                                document.getElementById(
                                    "FFmpegProbeSize",
                                ).value;

                            // Failover
                            config.EnableMovieFailover =
                                document.getElementById(
                                    "EnableMovieFailover",
                                ).checked;
                            config.EnableShowFailover =
                                document.getElementById(
                                    "EnableShowFailover",
                                ).checked;
                            config.FailoverGracePeriodSeconds =
                                parseInt(
                                    document.getElementById(
                                        "FailoverGracePeriodSeconds",
                                    ).value,
                                ) || 45;
                            config.FailoverWindowSeconds =
                                parseInt(
                                    document.getElementById(
                                        "FailoverWindowSeconds",
                                    ).value,
                                ) || 120;

                            ApiClient.updatePluginConfiguration(
                                JfresolveConfig.pluginUniqueId,
                                config,
                            ).then(function (result) {
                                Dashboard.processPluginConfigurationUpdateResult(
                                    result,
                                );
                            });
                        });
                        return false;
                    });
            </script>
        </div>
    </body>
</html>
